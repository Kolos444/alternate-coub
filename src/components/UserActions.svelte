<script lang="ts">
	import type {Coub} from "$lib/types";
	import {enhance} from "$app/forms";
	import {browser} from "$app/environment";

	export let coub: Coub;
	export let path: string;

	let likeButton: HTMLButtonElement;
	let bookmarkButton: HTMLButtonElement;
	let dislikeButton: HTMLButtonElement;

	let liked: boolean;
	let bookmarked: boolean;
	let disliked: boolean;

	$: liked = coub.like, enableButtons();
	$: bookmarked = coub.favourite, enableButtons();
	$: disliked = coub.dislike, enableButtons();

	const onSubmit = () => {
		disableButtons();
	};

	const disableButtons = () => {
		likeButton.disabled = true;
		bookmarkButton.disabled = true;
		dislikeButton.disabled = true;
	};
	const enableButtons = () => {
		if (browser && likeButton && bookmarkButton && dislikeButton) {
			likeButton.disabled = false;
			bookmarkButton.disabled = false;
			dislikeButton.disabled = false;
		}
	};
</script>

<form method="POST" use:enhance on:submit={onSubmit}>
	<input type="hidden" name="coubID" value="{coub.id}">
	<input type="hidden" name="liked" value="{liked}">
	<input type="hidden" name="bookmarked" value="{bookmarked}">
	<input type="hidden" name="disliked" value="{disliked}">
	<button type="submit" formaction="{path}?/like" class="like" class:marked={liked} bind:this={likeButton}>
		<svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
			<path clip-rule="evenodd"
				  d="m15.0946 4.58779-.0156.0449-.6402 2.17408c-.2862-.09794-.6047-.15591-.9556-.15591-.0177 0-.0353.00015-.0528.00046-.3786.00655-.7278.08344-1.0428.21486-.1029-.06515-.211-.12467-.3242-.17764-.4058-.18994-.8778-.29568-1.4168-.27513-.2871.01041-.5643.05937-.82744.1413-.01337-.03274-.0254-.06361-.03597-.09248l-1.03433-3.29222-.01042-.02983c-.21877-.62638-.65537-1.24355-1.2774-1.6573-.67182-.44686-1.70097-.718891-2.75473-.20883l-.00737.00357-.00735.00363c-1.61476.798-1.90168 2.64883-1.55322 3.88646.56382 2.17355 1.23406 4.22294 1.94598 6.27869-.14328.2224-.30821.4946-.47159.7984l-.00441.0082-.00434.0082c-.01527.0291-.03315.0609-.06833.123l-.01832.032c-.10664.1862-.36089.6299-.46426 1.2117-.11617.6539-.02182 1.2906.19159 1.914.16933.5009.37795.9646.66712 1.5395.44364.8825.9781 1.385 1.34274 1.7278l.01585.0149.00149.0014c.37837.3572.53135.5522.60837.6905.05109.0917.10101.2115.10101.4834 0 1.6569 1.34315 3 3 3h4.30493c1.6568 0 3-1.3431 3-3 0-.3857.1288-.7445.4651-1.5229l.0242-.0558c.215-.4971.5194-1.2005.6755-2.0051.1675-.8633.5961-3.0072.7743-3.898l.0002-.001.0003-.0018.0003-.0013.0743-.3717c.1753-.6346.4185-1.6228.5617-2.27797l.7621-3.52908c.1274-.59131.1127-1.34842-.1245-2.03748-.2387-.69351-.9781-1.92199-2.569-1.92199-1.6071 0-2.521 1.30424-2.8361 2.21251zm-7.45152 12.78171c.84052.7932 1.33819 1.4582 1.33819 2.6299 0 .5523.44771 1 1 1h4.30493c.5523 0 1-.4477 1-1 0-.8598.3132-1.5847.6292-2.3161.2282-.5284.458-1.0601.5722-1.6486.2099-1.0819.8621-4.338.8696-4.3701.1649-.5899.4104-1.5844.551-2.22777l.7609-3.52348c.0055-.02572.0104-.05263.0147-.08055.0043-.0277.0079-.05639.0108-.0859.0542-.54561-.123-1.37162-.7639-1.37162-.3861 0-.7666.34932-.9465.86795l-.9221 3.13139c-.0395.11428-.0838.22404-.1314.33048-.0925.20729-.1969.40194-.2997.59271-.1241.23093-.2517.46843-.3529.71879l-.0125.0315c-.0049.0124-.0097.0254-.0143.0387-.0054.0155-.0107.0315-.0161.0477-.0456.1375-.096.2897-.2601.2897-.075 0-.2118-.0357-.2681-.2709-.0082-.0667-.0194-.1355-.0339-.20518-.0101-.04858-.0218-.09762-.035-.14674l-.0004-.00149c-.1132-.41879-.3422-.84317-.7072-1.03833-.0462-.02468-.0945-.0457-.145-.06257-.0242-.00807-.0489-.01518-.074-.0213l-.0134-.00315c-.068-.01545-.1396-.02368-.2149-.02368-.483 0-.7484.33599-.9684.85754-.0224.05306-.0446.10873-.0662.16546-.0356.09268-.1612.14258-.2343.14258-.1462-.00713-.2436-.09446-.2624-.22991-.0051-.03659-.0115-.07305-.0192-.10926l-.0004-.00172c-.0493-.22871-.1519-.44744-.2969-.62648-.184-.22716-.4363-.39042-.7344-.4291-.0273-.00353-.0549-.00602-.0829-.00743-.032-.00161-.0645-.0018-.0975-.0005-.5098.01783-.99339.38853-1.17144.89825-.03739.11834-.16463.25308-.29238.25308-.19145 0-.33356-.2496-.43981-.48442l-.01296-.02895c-.01635-.0369-.03182-.07315-.04645-.10772l-.01015-.024c-.0298-.0705-.05601-.13254-.07914-.17652l-.02305-.04413c-.13284-.25431-.2798-.53564-.41361-.80904-.02577-.05265-.05105-.105-.07564-.15681-.10866-.22886-.204-.44711-.26925-.63324l-1.03644-3.29892c-.17632-.50485-.72457-.99064-1.2726-.72537-.4114.20331-.63524.74338-.56506 1.30272.00257.02043.00552.04089.00888.06136.01107.06758.02647.13527.0464.20251l.005.0193c.0965.37219.19634.74099.29923 1.10727.42899 1.52725.91096 3.01043 1.42524 4.51119.10811.3155.21765.6318.32842.9494.1237.3546.10121.6469-.06372.8697-.09184.123-.39359.5471-.68784 1.0943-.03239.0616-.06583.1206-.09877.1787-.21719.383-.4122.7269-.13738 1.5269.05151.1527.10883.3042.17668.466.10002.2385.2229.4993.38371.819.28301.5632.6035.8661.94461 1.1869z"
				  fill="#000" fill-rule="evenodd"></path>
		</svg>
		{coub.likes_count}
	</button>
	<button type="submit" formaction="{path}?/dislike" class="dislike" class:marked={disliked}
			bind:this={dislikeButton}>
		<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg">
			<path fill-rule="evenodd" clip-rule="evenodd"
				  d="M6.892 3.212c-.52.117-.926.473-1.209.783a7.13 7.13 0 00-.856 1.209c-.53.91-1.03 2.066-1.436 3.225-.405 1.16-.73 2.367-.887 3.386a7.318 7.318 0 00-.099 1.435c.02.387.095.925.431 1.338.418.515.991.804 1.536.973.548.169 1.14.238 1.694.26.17.008.34.01.51.01a6.259 6.259 0 00-.268.613c-.369.985-.398 2.259-.09 3.311C6.519 20.778 7.297 22 8.806 22c.637 0 1.203-.174 1.643-.57.418-.376.608-.854.712-1.233.078-.284.129-.605.167-.848l.028-.174c.053-.307.096-.438.129-.497.133-.238.39-.514.792-.839.398-.32.87-.633 1.387-.972l.068-.045c.48-.316 1.001-.657 1.454-1.014.396-.312.803-.682 1.104-1.12h2.854c.861 0 1.675-.562 1.903-1.46.58-2.281.74-5.082.36-6.96-.188-.938-1.018-1.468-1.824-1.489l-3.506-.09a1.005 1.005 0 00-.188.012 4.329 4.329 0 00-.528-.25 10.572 10.572 0 00-1.039-.348 26.726 26.726 0 00-2.604-.582 29.158 29.158 0 00-2.7-.355c-.786-.061-1.58-.077-2.125.046zm10.154 3.502c.015.079.029.158.042.238.123.77.172 1.699.163 2.624-.01.928-.078 1.886-.202 2.72-.019.13-.04.262-.063.392h2.134c.503-2.01.623-4.4.348-5.911l-2.422-.063zM4.403 13.152a1.3 1.3 0 00.026.22c.092.09.255.192.533.278.321.099.726.155 1.186.174.761.03 1.536-.04 2.168-.097.144-.013.28-.026.408-.036.028-.002.123-.01.24.007h.003c.051.008.527.074.76.563.244.516-.04.94-.072.987l-.001.002c-.069.103-.142.17-.163.19-.05.046-.1.083-.115.094l-.002.001-.05.037-.013.01a2.733 2.733 0 00-.293.241c-.237.226-.578.632-.837 1.322-.207.553-.238 1.381-.043 2.048.204.695.494.807.667.807a.817.817 0 00.256-.031c.034-.012.045-.021.048-.024.011-.01.064-.066.123-.278.046-.167.072-.333.107-.55.013-.084.027-.175.045-.277.052-.305.136-.75.357-1.143.318-.564.802-1.03 1.281-1.416.486-.39 1.039-.755 1.543-1.086l.036-.024c.507-.333.963-.632 1.347-.934.4-.315.635-.569.748-.77.113-.2.26-.694.375-1.464.108-.73.172-1.595.18-2.447.009-.855-.038-1.664-.138-2.287a4.07 4.07 0 00-.168-.714 1.124 1.124 0 00-.05-.118 2.74 2.74 0 00-.285-.133 8.63 8.63 0 00-.838-.278 24.772 24.772 0 00-2.402-.535 27.18 27.18 0 00-2.509-.33c-.751-.06-1.26-.049-1.496-.005-.019.013-.088.06-.205.188-.174.19-.38.48-.605.866-.446.767-.898 1.798-1.276 2.878-.377 1.08-.664 2.165-.798 3.032-.067.436-.09.783-.078 1.032z"
				  fill="#000"></path>
		</svg>
		{coub.dislikes_count}
	</button>
	<button type="submit" formaction="{path}?/bookmark" class="bookmark" class:marked={bookmarked}
			bind:this={bookmarkButton}>
		{#if bookmarked}
			<svg width="24" height="24" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path fill-rule="evenodd" clip-rule="evenodd"
					  d="M16 4H8a2 2 0 00-2 2v13.603l4.054-3.535c.074-.065.15-.125.228-.18a8.007 8.007 0 00-.248 2.851l-3.266 2.848C5.688 22.529 4 21.762 4 20.328V6a4 4 0 014-4h8a4 4 0 014 4v4.252A8.012 8.012 0 0018 10V6a2 2 0 00-2-2zm8 14a6 6 0 11-12 0 6 6 0 0112 0zm-2.31-2.723a1 1 0 01.033 1.413l-3.818 4a1 1 0 01-1.447 0l-2.181-2.285a1 1 0 111.446-1.381l1.459 1.528 3.095-3.242a1 1 0 011.413-.033z"
					  fill="#fff"></path>
			</svg>
		{:else}
			<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg">
				<path fill-rule="evenodd" clip-rule="evenodd"
					  d="M8 4h8a2 2 0 012 2v13.582l-3.995-3.508a3 3 0 00-3.95-.006L6 19.603V6a2 2 0 012-2zM4 6a4 4 0 014-4h8a4 4 0 014 4v14.311c0 1.436-1.693 2.203-2.772 1.255l-4.543-3.989a1 1 0 00-1.317-.002l-4.6 4.012C5.688 22.529 4 21.762 4 20.328V6z"
					  fill="#fff"></path>
			</svg>
		{/if}
	</button>
</form>

<style>
	.like, .bookmark, .dislike {
		border: none;
		background: none;
		cursor: pointer;
		padding: 0;
	}

	path {
		fill: white;
	}

	.marked path {
		fill: #0084FF;
	}

	.dislike.marked path {
		fill: red;
	}

	form {
		display: flex;
		flex-direction: column;

		align-items: center;

	}

	button {
		display: flex;
		flex-direction: column;

		align-items: center;
	}

	button:hover {
		background: rgba(34, 34, 34, 0.2);
		border-radius: 50%;
	}
</style>
